package all;

import java.util.*;

public class Problem1ValidEmails {

	private int UsernameValid(string username) {
		Regex regex = new Regex("^[A-Za-z_]+$");
		if (!regex.IsMatch(username)) {
			return -1;
		}
		return 0;
	}

	private int DomainValid(string domain) {
		Regex regex = new Regex("^[a-z]+$");
		if (!regex.IsMatch(domain)) {
			return -1;
		}
		if (domain.Length < 2 || domain.Length > 4) {
			return -1;
		}
		return 0;
	}

	private int HostValid(string host) {
		Regex regex = new Regex("^[a-z]+$");
		if (!regex.IsMatch(host)) {
			return -1;
		}
		return 0;
	}

	private int ValidationOfEmail(string email) {
		string[] emailElements = email.Split('@', '.');
		string username = emailElements[0];
		string host = emailElements[1];
		string domain = emailElements[2];
		if (UsernameValid(username) != 0 || HostValid(host) != 0
				|| DomainValid(domain) != 0) {
			return -1;
		}
		return 0;
	}

	private int ValidationOfName(string name) {
		Regex regex = new Regex("^[A-Za-z]+$");
		if (!regex.IsMatch(name)) {
			return -1;
		}
		return 0;
	}

	public static void Main(String[] args)
    {
        StreamReader reader = null;
        StreamWriter writer = null;

        if (!File.Exists("../../Files/test.001.in.txt"))
        {
            Console.WriteLine("File mails.txt does not exist");
            return;
        }

        try
        {
            writer = new StreamWriter("../../Files/test.001.out.txt");
            reader = new StreamReader("../../Files/test.001.in.txt");
                string line = string.Empty;
                while (true)
                {
                    line = reader.ReadLine();
                    if (line == null)
                    {
                        break;
                    }

                    string[] elements = line.Split(' ');
                    string firstName = elements[0];
                    string secondName = elements[1];
                    string email = elements[2];

                    if (ValidationOfName(firstName) != 0 ||   
                                ValidationOfName(secondName) != 0)
                    {
                        Console.WriteLine("Error in names");
                        continue;
                    }

                    try
                    {
                        if (ValidationOfEmail(email) != 0)
                        {
                            Console.WriteLine("Error in email syntax");
                            continue;
                        }
                    }
                    catch (Exception)
                    {
                        Console.WriteLine("Error");
                        continue;
                    }     
                  
                    writer.WriteLine(firstName + " " + secondName + " " + email);
                }
        }
        catch (Exception)
        {
            Console.WriteLine("Error");
        }
        finally
        {
            reader.Close();
            writer.Close();
        }
    }
}
